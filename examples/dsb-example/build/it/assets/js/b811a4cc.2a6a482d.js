"use strict";(self.webpackChunkdevsecblueprint=self.webpackChunkdevsecblueprint||[]).push([[278],{512:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/sonarqube-change-admin-creds-74d811d5aa721291383715d9416e98ea.png"},2344:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/sonarqube-login-dashboard-784a9042db8ad3861b2ccee02dcd5746.png"},5555:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"projects/devsecops-home-lab/installation-and-configuration/security-tools/install-config-sonarqube","title":"SonarQube","description":"Overview","source":"@site/docs/projects/devsecops-home-lab/installation-and-configuration/security-tools/sonarqube.md","sourceDirName":"projects/devsecops-home-lab/installation-and-configuration/security-tools","slug":"/projects/devsecops-home-lab/installation-and-configuration/security-tools/install-config-sonarqube","permalink":"/it/projects/devsecops-home-lab/installation-and-configuration/security-tools/install-config-sonarqube","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"install-config-sonarqube","title":"SonarQube","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Security Tools","permalink":"/it/category/security-tools"},"next":{"title":"Trivy","permalink":"/it/projects/devsecops-home-lab/installation-and-configuration/security-tools/install-config-trivy"}}');var i=s(4848),t=s(8453);const o={id:"install-config-sonarqube",title:"SonarQube",sidebar_position:4},a=void 0,l={},c=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installation Steps",id:"installation-steps",level:2},{value:"Configuring SonarQube",id:"configuring-sonarqube",level:2},{value:"Jenkins Integration with SonarQube",id:"jenkins-integration-with-sonarqube",level:2},{value:"You&#39;re Done",id:"youre-done",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["This installation happens on the ",(0,i.jsx)(n.code,{children:"dsb-hub"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["According to ",(0,i.jsx)(n.a,{href:"https://docs.sonarsource.com/sonarqube/latest/#what-is-sonarcloud",children:"SonarQube's Website"}),", SonarQube is an open-source platform used to continuously inspect the quality of code in various programming languages. It is designed to detect bugs, security vulnerabilities, and code smells, providing detailed reports to help developers maintain high standards in their codebases. SonarQube is widely used in DevSecOps environments to ensure that code remains secure, maintainable, and follows industry best practices."]}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Note: This installation uses PostgreSQL 16.6 (Ubuntu 16.6-0ubuntu0.24.04.1)"}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Switch to the PostgreSQL User"}),(0,i.jsx)(n.br,{}),"\n","First, switch to the ",(0,i.jsx)(n.code,{children:"postgres"})," user to perform database-related tasks:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo -i -u postgres\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Create a Database and User for SonarQube"}),(0,i.jsx)(n.br,{}),"\n","While logged in as the ",(0,i.jsx)(n.code,{children:"postgres"})," user, create a new PostgreSQL user and database for SonarQube:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Create the sonar user and database\r\ncreateuser sonar\r\ncreatedb sonar\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Set Password and Grant Privileges"}),(0,i.jsx)(n.br,{}),"\n","Still as the ",(0,i.jsx)(n.code,{children:"postgres"})," user, start the PostgreSQL session. Set a password for the ",(0,i.jsx)(n.code,{children:"sonar"})," user and grant the necessary privileges:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Start the PostgreSQL session\r\npsql\r\n\r\n# Set password for sonar user\r\nALTER USER sonar WITH ENCRYPTED PASSWORD 'your_password';\r\n\r\n# Grant initial database privileges\r\nGRANT ALL PRIVILEGES ON DATABASE sonar TO sonar;\r\n\r\n# Connect to the sonar database to grant schema privileges\r\n\\c sonar\r\n\r\n# Grant all necessary schema privileges\r\nGRANT ALL ON SCHEMA public TO sonar;\r\nGRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO sonar;\r\nGRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO sonar;\r\nGRANT ALL PRIVILEGES ON ALL FUNCTIONS IN SCHEMA public TO sonar;\r\nGRANT USAGE ON SCHEMA public TO sonar;\r\nGRANT CREATE ON SCHEMA public TO sonar;\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Exit PostgreSQL and Return to the Original User"}),(0,i.jsx)(n.br,{}),"\n","Exit from the PostgreSQL session return to the original user:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Exit PostgreSQL session\r\n\\q\r\n\r\n# Return to the original user\r\nexit\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Update the ",(0,i.jsx)(n.code,{children:"pg_hba.conf"})," File"]}),(0,i.jsx)(n.br,{}),"\n","Modify the ",(0,i.jsx)(n.code,{children:"pg_hba.conf"})," file to configure authentication:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/postgresql/16/main/pg_hba.conf\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Add the following line to enable ",(0,i.jsx)(n.code,{children:"scram-sha-256"})," authentication for the ",(0,i.jsx)(n.code,{children:"sonar"})," user:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-conf",children:"local   sonar           sonar                                   scram-sha-256\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"installation-steps",children:"Installation Steps"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Download and Install SonarQube"}),(0,i.jsx)(n.br,{}),"\n","Download the SonarQube package and extract it:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd /opt\r\nsudo wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-10.6.0.92116.zip\r\nsudo apt install unzip -y\r\nsudo unzip sonarqube-10.6.0.92116.zip\r\nsudo mv sonarqube-10.6.0.92116 sonarqube\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Create a SonarQube User"}),(0,i.jsx)(n.br,{}),"\n","Create a dedicated user for running SonarQube and set the correct permissions:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo adduser sonar\r\nsudo chown -R sonar:sonar /opt/sonarqube\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Update SonarQube Database Configuration"}),(0,i.jsx)(n.br,{}),"\n","Edit the ",(0,i.jsx)(n.code,{children:"sonar.properties"})," file to configure SonarQube's connection to the PostgreSQL database:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo nano /opt/sonarqube/conf/sonar.properties\n"})}),"\n",(0,i.jsx)(n.p,{children:"Update the PostgreSQL settings:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",children:"# PostgreSQL settings\r\nsonar.jdbc.username=sonar\r\nsonar.jdbc.password=your_password\r\nsonar.jdbc.url=jdbc:postgresql://localhost/sonar\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Set Up the SonarQube Service"}),(0,i.jsx)(n.br,{}),"\n","Create a new systemd service file for SonarQube:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/systemd/system/sonarqube.service\n"})}),"\n",(0,i.jsx)(n.p,{children:"Copy the following content into the file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",children:"[Unit]\r\nDescription=SonarQube service\r\nAfter=syslog.target network.target\r\n\r\n[Service]\r\nType=forking\r\nUser=sonar\r\nGroup=sonar\r\n\r\nExecStart=/opt/sonarqube/bin/linux-x86-64/sonar.sh start\r\nExecStop=/opt/sonarqube/bin/linux-x86-64/sonar.sh stop\r\nExecReload=/opt/sonarqube/bin/linux-x86-64/sonar.sh restart\r\n\r\nRestart=on-failure\r\n\r\n[Install]\r\nWantedBy=multi-user.target\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Reload Systemd and Start SonarQube"}),(0,i.jsx)(n.br,{}),"\n","Reload the systemd daemon and start the SonarQube service:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reload\r\nsudo systemctl start sonarqube\r\nsudo systemctl enable sonarqube\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Confirm SonarQube is Running"}),(0,i.jsx)(n.br,{}),"\n","Verify that SonarQube is running by opening your web browser and navigating to:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"http://your_ip_address:9000\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"SonarQube Interface",src:s(2344).A+"",width:"1640",height:"1396"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"configuring-sonarqube",children:"Configuring SonarQube"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Log into SonarQube and type in the default credentials (username: ",(0,i.jsx)(n.code,{children:"admin"}),", password: ",(0,i.jsx)(n.code,{children:"admin"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Change your password to something new after the first login.\r\n",(0,i.jsx)(n.img,{alt:"alt text",src:s(512).A+"",width:"845",height:"659"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["You will be directed to the dashboard. Click on 'Create Project':\r\n",(0,i.jsx)(n.img,{alt:"alt text",src:s(7676).A+"",width:"833",height:"656"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create a local project and enter ",(0,i.jsx)(n.code,{children:"owasp-juice-shop"})," as the display name and project key. Set branch = ",(0,i.jsx)(n.code,{children:"master"}),".\r\n",(0,i.jsx)(n.img,{alt:"alt text",src:s(9201).A+"",width:"511",height:"423"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Hit next and set 'Use global setting', then hit 'Create Project'."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"jenkins-integration-with-sonarqube",children:"Jenkins Integration with SonarQube"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["From the Jenkins Dashboard, navigate to ",(0,i.jsx)(n.strong,{children:"Manage Jenkins > Manage Plugins"})," and install the ",(0,i.jsx)(n.strong,{children:"SonarQube Scanner"})," plugin."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Navigate to ",(0,i.jsx)(n.strong,{children:"Credentials > System"})," from the Jenkins Dashboard."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click the ",(0,i.jsx)(n.strong,{children:"Global credentials (unrestricted)"})," link in the System table."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Add credentials"})," and add the following information:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Kind"}),": Secret Text"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scope"}),": Global"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Secret"}),": Generate a token at ",(0,i.jsx)(n.strong,{children:"User > My Account > Security"})," in SonarQube, and copy and paste it here."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["From the Jenkins Dashboard, navigate to ",(0,i.jsx)(n.strong,{children:"Manage Jenkins > Configure System"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["In the ",(0,i.jsx)(n.strong,{children:"SonarQube Servers"})," section, click ",(0,i.jsx)(n.strong,{children:"Add SonarQube"}),". Add the following information:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": Give a unique name to your SonarQube instance."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Server URL"}),": Your SonarQube instance URL."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Credentials"}),": Select the credentials created in step 4."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Save"})," to complete the integration."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"youre-done",children:"You're Done"}),"\n",(0,i.jsx)(n.p,{children:"You\u2019ve successfully installed and configured SonarQube and integrated it with Jenkins. This setup allows you to continuously monitor code quality and security vulnerabilities."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},7676:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/sonarqube-dashboard-c10352491501ab166d98fb07b827b4e9.png"},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}},9201:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/sonarqube-project-creation-1dada365ac0ee2be1e94346cbb5f8735.png"}}]);