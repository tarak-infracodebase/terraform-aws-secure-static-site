"use strict";(self.webpackChunkdevsecblueprint=self.webpackChunkdevsecblueprint||[]).push([[5308],{3669:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"projects/devsecops-home-lab/installation-and-configuration/install-config-docker","title":"Docker","description":"Overview","source":"@site/docs/projects/devsecops-home-lab/installation-and-configuration/docker.md","sourceDirName":"projects/devsecops-home-lab/installation-and-configuration","slug":"/projects/devsecops-home-lab/installation-and-configuration/install-config-docker","permalink":"/fr/projects/devsecops-home-lab/installation-and-configuration/install-config-docker","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"id":"install-config-docker","title":"Docker","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Installation and Configuration","permalink":"/fr/category/installation-and-configuration"},"next":{"title":"Gitea","permalink":"/fr/projects/devsecops-home-lab/installation-and-configuration/install-config-gitea"}}');var o=r(4848),i=r(8453);const t={id:"install-config-docker",title:"Docker",sidebar_position:1},c=void 0,l={},a=[{value:"Overview",id:"overview",level:2},{value:"Docker Installation Steps",id:"docker-installation-steps",level:2},{value:"Docker Registry Installation Steps",id:"docker-registry-installation-steps",level:2},{value:"You&#39;re Done",id:"youre-done",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"This installation happens on both of the machines."}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["According to ",(0,o.jsx)(n.a,{href:"https://docs.docker.com/get-started/overview/",children:"Docker's Website"}),", Docker is an open platform for developing, shipping, and running applications. Docker enables you to separate your applications from your infrastructure so you can deliver software quickly. With Docker, you can manage your infrastructure in the same ways you manage your applications. By taking advantage of Docker's methodologies for shipping, testing, and deploying code, you can significantly reduce the delay between writing code and running it in production."]}),"\n",(0,o.jsx)(n.h2,{id:"docker-installation-steps",children:"Docker Installation Steps"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Update the Package Index"})}),"\n",(0,o.jsx)(n.p,{children:"First, update your existing list of packages:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo apt-get update\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Install Required Packages"})}),"\n",(0,o.jsx)(n.p,{children:"Install the necessary packages to allow apt to use a repository over HTTPS:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo apt-get install \\\r\n    ca-certificates \\\r\n    curl \\\r\n    gnupg \\\r\n    lsb-release\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Add Docker\u2019s Official GPG Key"})}),"\n",(0,o.jsx)(n.p,{children:"Add Docker\u2019s official GPG key to your system:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Set Up the Stable Repository"})}),"\n",(0,o.jsx)(n.p,{children:"Use the following command to set up the stable Docker repository:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'echo \\\r\n  "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \\\r\n  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Install Docker Engine"})}),"\n",(0,o.jsxs)(n.p,{children:["Update the package index again and install Docker Engine, along with ",(0,o.jsx)(n.code,{children:"containerd"})," and ",(0,o.jsx)(n.code,{children:"docker-compose"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo apt-get update\r\nsudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-compose\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Verify Docker Installation"})}),"\n",(0,o.jsx)(n.p,{children:"After the installation, verify that Docker is installed and running correctly:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo docker --version\n"})}),"\n",(0,o.jsx)(n.p,{children:"This command should return the Docker version installed."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Start and Enable Docker Service"})}),"\n",(0,o.jsx)(n.p,{children:"Ensure Docker starts on boot:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo systemctl start docker\r\nsudo systemctl enable docker\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Manage Docker as a Non-Root User (Optional)"})}),"\n",(0,o.jsxs)(n.p,{children:["By default, Docker commands need to be run with ",(0,o.jsx)(n.code,{children:"sudo"}),". If you want to run Docker commands as a non-root user, you need to add your user to the ",(0,o.jsx)(n.code,{children:"docker"})," group:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo usermod -aG docker $USER\r\nsudo usermod -aG docker jenkins\n"})}),"\n",(0,o.jsx)(n.p,{children:"After running this command, log out and back in, or run the following command to apply the group membership:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"newgrp docker\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Test Docker Installation"})}),"\n",(0,o.jsx)(n.p,{children:"Test the Docker installation by running a simple Docker container:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker run hello-world\n"})}),"\n",(0,o.jsx)(n.p,{children:"This command will download a test image, run it in a container, and print a confirmation message."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"(Optional) Install Additional Docker Tools"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"You may also want to install Docker Compose if it's not already included:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo apt-get install docker-compose-plugin\n"})}),"\n",(0,o.jsx)(n.h2,{id:"docker-registry-installation-steps",children:"Docker Registry Installation Steps"}),"\n",(0,o.jsx)(n.p,{children:"Setting up your own Docker registry locally allows you to host your Docker images privately without relying on a third-party service like Docker Hub. Below are the steps to set up and use a local Docker registry on your machine or server."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Create Necessary Directories and Files"})}),"\n",(0,o.jsx)(n.p,{children:"Begin by navigating to your home directory and creating directories to store your Docker registry files:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cd ~\r\nmkdir -p apps/docker\r\ncd apps/docker\r\ntouch docker-compose.yml\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsxs)(n.strong,{children:["Set Up ",(0,o.jsx)(n.code,{children:"docker-compose.yml"})]})}),"\n",(0,o.jsxs)(n.p,{children:["Next, edit the ",(0,o.jsx)(n.code,{children:"docker-compose.yml"})," file with the following content:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'version: "3.8"\r\n\r\nservices:\r\n  registry:\r\n    image: registry:2.8.2\r\n    ports:\r\n      - "5000:5000"\r\n    environment:\r\n      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Origin: "[http://registry.example.com]"\r\n      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Methods: "[HEAD,GET,OPTIONS,DELETE]"\r\n      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Credentials: "[true]"\r\n      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Headers: "[Authorization,Accept,Cache-Control]"\r\n      REGISTRY_HTTP_HEADERS_Access-Control-Expose-Headers: "[Docker-Content-Digest]"\r\n      REGISTRY_STORAGE_DELETE_ENABLED: "true"\r\n      REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY: /var/lib/registry\r\n    volumes:\r\n      - ./registry-data:/var/lib/registry\r\n\r\n  ui:\r\n    image: joxit/docker-registry-ui:latest\r\n    ports:\r\n      - "8082:80"\r\n    environment:\r\n      - SINGLE_REGISTRY=true\r\n      - REGISTRY_TITLE=Docker Registry UI\r\n      - DELETE_IMAGES=true\r\n      - SHOW_CONTENT_DIGEST=true\r\n      - NGINX_PROXY_PASS_URL=http://<your_dsb_hub_ip_address>:5000\r\n      - SHOW_CATALOG_NB_TAGS=true\r\n      - CATALOG_MIN_BRANCHES=1\r\n      - CATALOG_MAX_BRANCHES=1\r\n      - TAGLIST_PAGE_SIZE=100\r\n      - REGISTRY_SECURED=false\r\n      - CATALOG_ELEMENTS_LIMIT=1000\r\n    depends_on:\r\n      - registry\r\n\r\nvolumes:\r\n  registry-data:\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Deploy the Docker Registry"})}),"\n",(0,o.jsx)(n.p,{children:"Use Docker Compose to deploy the Docker registry and the UI:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker compose up -d\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Configure Docker Daemon"})}),"\n",(0,o.jsx)(n.p,{children:"To allow Docker to interact with your insecure registry, you need to update the Docker daemon configuration:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/docker/daemon.json\n"})}),"\n",(0,o.jsx)(n.p,{children:"Add the following content:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\r\n  "insecure-registries": ["<your_dsb_hub_ip_address>:5000"]\r\n}\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Restart Docker Service"})}),"\n",(0,o.jsx)(n.p,{children:"After updating the Docker daemon configuration, restart Docker to apply the changes:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart docker\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Configure Additional Docker Nodes (if applicable)"})}),"\n",(0,o.jsxs)(n.p,{children:["If you're working with additional Docker nodes, such as ",(0,o.jsx)(n.code,{children:"dsb-hub-01"}),", you'll need to apply similar settings:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo nano /var/snap/docker/current/config/daemon.json\n"})}),"\n",(0,o.jsx)(n.p,{children:"Add the following content:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\r\n  "log-level": "error",\r\n  "insecure-registries": ["<your_dsb_hub_ip_address>:5000"]\r\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Then, restart the Docker service:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo snap restart docker\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"youre-done",children:"You're Done"}),"\n",(0,o.jsx)(n.p,{children:"You've completed configuring and installing Docker and the Docker Registry on your servers."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>c});var s=r(6540);const o={},i=s.createContext(o);function t(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);