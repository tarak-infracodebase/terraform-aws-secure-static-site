"use strict";(self.webpackChunkdevsecblueprint=self.webpackChunkdevsecblueprint||[]).push([[4534],{1773:(e,n,r)=>{r.d(n,{A:()=>i});const i=r.p+"assets/images/gitea-create-project-5d10e876108338e3ad4afe988e0cd5b3.png"},6681:(e,n,r)=>{r.d(n,{A:()=>i});const i=r.p+"assets/images/gitea-authorize-application-f8c8383bcaeea33c53fe819fed60b892.png"},7351:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"projects/devsecops-home-lab/create-and-configure-pipeline/create-repository-pipeline","title":"Setting Up Repository And Pipeline","description":"A guide to setting up the OWASP Juice Shop project with Sonar Scanning, Gitea, and Jenkins.","source":"@site/docs/projects/devsecops-home-lab/create-and-configure-pipeline/creating-repository.md","sourceDirName":"projects/devsecops-home-lab/create-and-configure-pipeline","slug":"/projects/devsecops-home-lab/create-and-configure-pipeline/create-repository-pipeline","permalink":"/hi/projects/devsecops-home-lab/create-and-configure-pipeline/create-repository-pipeline","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"create-repository-pipeline","title":"Setting Up Repository And Pipeline","description":"A guide to setting up the OWASP Juice Shop project with Sonar Scanning, Gitea, and Jenkins.","sidebar\\\\_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Creating & Configuring Jenkins Pipeline","permalink":"/hi/projects/devsecops-home-lab/create-and-configure-pipeline/create-jenkins-piepline"},"next":{"title":"Testing and Validating Results","permalink":"/hi/category/testing-and-validating-results"}}');var t=r(4848),s=r(8453);const o={id:"create-repository-pipeline",title:"Setting Up Repository And Pipeline",description:"A guide to setting up the OWASP Juice Shop project with Sonar Scanning, Gitea, and Jenkins.",sidebar_position:1},a=void 0,l={},c=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Clone the Codebase",id:"step-1-clone-the-codebase",level:2},{value:"Step 2: Create a New Project in Gitea",id:"step-2-create-a-new-project-in-gitea",level:2},{value:"Step 3: Point the Local Repository to Gitea",id:"step-3-point-the-local-repository-to-gitea",level:2},{value:"Step 4: Authorize Your Application",id:"step-4-authorize-your-application",level:2},{value:"Step 5: Confirm the Changes",id:"step-5-confirm-the-changes",level:2},{value:"Step 6: Remove GitHub Workflows Directory",id:"step-6-remove-github-workflows-directory",level:2},{value:"Step 7: Create Jenkinsfile for CI/CD Pipeline",id:"step-7-create-jenkinsfile-for-cicd-pipeline",level:2},{value:"Conclusion",id:"conclusion",level:2}];function p(e){const n={code:"code",em:"em",h2:"h2",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"In this section of the guide, you will learn how to set up a Jenkins pipeline for the OWASP Juice Shop project, integrating it with Gitea for version control, SonarQube for static code analysis, and Docker for containerization. The process includes cloning the codebase, configuring access tokens in Gitea, installing necessary Jenkins plugins, creating a Jenkins pipeline, and setting up webhooks and SSH keys for secure communication between your systems. By the end of this guide, your pipeline will be fully automated to handle code quality checks, security scans, and deployments."}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(n.p,{children:"Before starting, ensure that you have the following:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Access to a Gitea instance"}),"\n",(0,t.jsx)(n.li,{children:"Jenkins set up with required plugins (e.g., Git, SonarQube, Docker, etc.)"}),"\n",(0,t.jsx)(n.li,{children:"A SonarQube instance"}),"\n",(0,t.jsx)(n.li,{children:"Docker installed on your machine"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"step-1-clone-the-codebase",children:"Step 1: Clone the Codebase"}),"\n",(0,t.jsx)(n.p,{children:"On your local machine, clone the juice-shop-sonarscanning repository:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/devsecblueprint/juice-shop-sonarscanning.git\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-2-create-a-new-project-in-gitea",children:"Step 2: Create a New Project in Gitea"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Log into your Gitea instance and navigate to create a new repository."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Create New Project",src:r(7848).A+"",width:"787",height:"405"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Fill out the necessary information:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Repository name"}),": ",(0,t.jsx)(n.code,{children:"owasp-juice-shop"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Visibility"}),": ",(0,t.jsx)(n.code,{children:"public"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Description"}),": ",(0,t.jsx)(n.em,{children:"(Optional)"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Default branch"}),": ",(0,t.jsx)(n.code,{children:"master"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Repository Details",src:r(7936).A+"",width:"940",height:"884"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Click on the ",(0,t.jsx)(n.strong,{children:"Create Repository"})," button."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Confirm that the repository has been created successfully."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Repository Created",src:r(1773).A+"",width:"1411",height:"740"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"step-3-point-the-local-repository-to-gitea",children:"Step 3: Point the Local Repository to Gitea"}),"\n",(0,t.jsxs)(n.p,{children:["In your local ",(0,t.jsx)(n.code,{children:"juice-shop-sonarscanning"})," directory, update the git origin to point to your new Gitea repository:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd juice-shop-sonarscanning/\r\ngit remote remove origin\r\ngit remote add origin http://<your_gitea_server_ip>/<your_username>/owasp-juice-shop.git\r\ngit push -u origin master\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-4-authorize-your-application",children:"Step 4: Authorize Your Application"}),"\n",(0,t.jsx)(n.p,{children:"After pushing your code, Gitea might prompt you to authorize your application."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Authorize Application",src:r(6681).A+"",width:"892",height:"501"})}),"\n",(0,t.jsx)(n.h2,{id:"step-5-confirm-the-changes",children:"Step 5: Confirm the Changes"}),"\n",(0,t.jsx)(n.p,{children:"Ensure that your changes have been pushed to the Gitea repository."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Changes Confirmed",src:r(7568).A+"",width:"1563",height:"859"})}),"\n",(0,t.jsx)(n.h2,{id:"step-6-remove-github-workflows-directory",children:"Step 6: Remove GitHub Workflows Directory"}),"\n",(0,t.jsx)(n.p,{children:"Remove the GitHub workflows directory from the repository:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'rm -rf .github/workflows\r\ngit add .\r\ngit commit -m "removing workflows"\r\ngit push\n'})}),"\n",(0,t.jsx)(n.h2,{id:"step-7-create-jenkinsfile-for-cicd-pipeline",children:"Step 7: Create Jenkinsfile for CI/CD Pipeline"}),"\n",(0,t.jsxs)(n.p,{children:["Create a ",(0,t.jsx)(n.code,{children:"Jenkinsfile"})," in the root directory of your repository with the following content:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-groovy",children:"pipeline {\r\n    agent any\r\n\r\n    environment {\r\n       SONAR_TOKEN = credentials('sonar-analysis')\r\n       SONAR_PROJECT_KEY = 'owasp-juice-shop'\r\n       DOCKER_IMAGE_NAME = 'owasp-juice-shop'\r\n       NEXUS_DOCKER_REGISTRY = '<your_dsb_hub_ip_address>:8082'\r\n       NEXUS_DOCKER_PUSH_INDEX = '<your_dsb_hub_ip_address>:8083'\r\n       NEXUS_DOCKER_PUSH_PATH = 'repository/docker-host'\r\n    }\r\n\r\n    stages {\r\n        stage('Clone') {\r\n            steps {\r\n                checkout scmGit(branches: [[name: '*/master']], extensions: [], userRemoteConfigs: [[credentialsId: 'Gitea PAT', url: 'http://<your_dsb_hub_ip_address>/<your_username>/owasp-juice-shop.git']])\r\n            }\r\n        }\r\n        stage('Build') {\r\n            steps {\r\n                sh 'docker build -t ${DOCKER_IMAGE_NAME}:${BUILD_NUMBER} .'\r\n            }\r\n        }\r\n        stage('Security Scan'){\r\n            parallel {\r\n                stage('Sonar Scan') {\r\n                    steps {\r\n                        script {\r\n                            try{\r\n                                withSonarQubeEnv(installationName: 'Sonar Server', credentialsId: 'sonar-analysis') {\r\n                                    sh '''\r\n                                    docker run --rm \\\r\n                                    -e SONAR_HOST_URL=\"${SONAR_HOST_URL}\" \\\r\n                                    -e SONAR_TOKEN=\"${SONAR_TOKEN}\" \\\r\n                                    -v \"$(pwd):/usr/src\" \\\r\n                                    sonarsource/sonar-scanner-cli \\\r\n                                    -Dsonar.projectKey=\"${SONAR_PROJECT_KEY}\" \\\r\n                                    -Dsonar.qualitygate.wait=true \\\r\n                                    -Dsonar.sources=.\r\n                                    '''\r\n                                }\r\n                            } catch (Exception e) {\r\n                                echo \"Quality Gate check has failed: ${e}\"\r\n                                currentBuild.result = 'UNSTABLE'\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                stage('Security Scan') {\r\n                    steps {\r\n                        sh '''\r\n                            # Trivy scan for HIGH and CRITICAL vulnerabilities\r\n                            # To fail the build on any vulnerability, add: --exit-code 1\r\n                            # To generate an HTML report, add: --format html --output trivy-report.html\r\n                            trivy image --severity HIGH,CRITICAL ${DOCKER_IMAGE_NAME}:${BUILD_NUMBER} --format html --output trivy-report.html\r\n                        '''\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        stage('Publish Trivy Report') {\r\n            steps {\r\n                publishHTML([\r\n                    allowMissing: false,\r\n                    alwaysLinkToLastBuild: true,\r\n                    keepAll: true,\r\n                    reportDir: '.',\r\n                    reportFiles: 'trivy-report.html',\r\n                    reportName: 'Trivy Vulnerability Report'\r\n                ])\r\n            }\r\n        }\r\n        stage('Publish') {\r\n            steps {\r\n                script {\r\n                    withCredentials([usernamePassword(credentialsId: 'nexus', passwordVariable: 'NEXUS_PASSWORD', usernameVariable: 'NEXUS_USERNAME')]) {\r\n                        sh \"\"\"\r\n                        docker login ${NEXUS_DOCKER_PUSH_INDEX} -u $NEXUS_USERNAME -p $NEXUS_PASSWORD\r\n                        docker tag ${DOCKER_IMAGE_NAME}:${BUILD_NUMBER} ${NEXUS_DOCKER_PUSH_INDEX}/${NEXUS_DOCKER_PUSH_PATH}/${DOCKER_IMAGE_NAME}:latest\r\n                        docker push ${NEXUS_DOCKER_PUSH_INDEX}/${NEXUS_DOCKER_PUSH_PATH}/${DOCKER_IMAGE_NAME}:latest\r\n                        \"\"\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        stage('Deploy') {\r\n            agent { label 'dsb-node-01' }\r\n            steps {\r\n                script {\r\n                        echo 'Deploying to DSB Node 01'\r\n                        sh '''\r\n                        docker pull ${NEXUS_DOCKER_PUSH_INDEX}/${NEXUS_DOCKER_PUSH_PATH}/${DOCKER_IMAGE_NAME}:latest\r\n                        docker stop ${DOCKER_IMAGE_NAME} || true\r\n                        docker rm ${DOCKER_IMAGE_NAME} || true\r\n                        docker run -d --name ${DOCKER_IMAGE_NAME} -p 8084:3000 ${NEXUS_DOCKER_PUSH_INDEX}/${NEXUS_DOCKER_PUSH_PATH}/${DOCKER_IMAGE_NAME}:latest\r\n                        '''\r\n                }\r\n            }\r\n        }\r\n    }\r\n    post {\r\n        always {\r\n            cleanWs()\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"This pipeline performs the following steps:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Clone the Repository"}),": Pulls the ",(0,t.jsx)(n.code,{children:"owasp-juice-shop"})," project from a Gitea repository."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Build the Application"}),": Builds a Docker image of the application and tags it with the build number."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Run Security Scans"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"SonarQube"}),": Analyzes code quality and enforces a quality gate."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Trivy"}),": Scans the Docker image for vulnerabilities (HIGH and CRITICAL)."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Publish to Nexus"}),": Tags and pushes the built Docker image to a Nexus Docker registry."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Deploy"}),": Pulls the latest Docker image from Nexus and deploys it to a specific server, replacing any existing instance."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Cleanup"}),": Cleans up the workspace after the build."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,t.jsx)(n.p,{children:"By following these steps, you've successfully set up the OWASP Juice Shop project with Sonar Scanning on Gitea and Jenkins. Your CI/CD pipeline is now ready to ensure code quality and security throughout the development process."})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},7568:(e,n,r)=>{r.d(n,{A:()=>i});const i=r.p+"assets/images/gitea-repo-populated-05929207fa9333f893ef3600784bff50.png"},7848:(e,n,r)=>{r.d(n,{A:()=>i});const i=r.p+"assets/images/gitea-create-repository-401baa83573ffaedf7982a38218128bd.png"},7936:(e,n,r)=>{r.d(n,{A:()=>i});const i=r.p+"assets/images/gitea-repo-details-89a45cc664b43fb6001011849b8bc5e5.png"},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var i=r(6540);const t={},s=i.createContext(t);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);